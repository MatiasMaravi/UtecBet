{% extends "bootstrap/base.html" %}

{% block title %}
Dashboard
{% endblock %}

{% block styles %}
{{super()}}
<link rel="stylesheet" href="{{url_for('.static', filename='css/dashboard.css')}}">
{% endblock %}


{% block content %}
<style>
  body {
    background-image: url('https://todosport.pe/wp-content/uploads/2022/08/Como-apuesta-la-gente-en-los-deportes.jpg');
    background-repeat: no-repeat;
    background-size:cover;
  }
  </style>
      <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
          <div class="navbar-header">
            <a class="navbar-brand" href="#">MATCHES TODAY</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
              {% if current_user.is_admin == True %}
              <li class="nav-item">
                <a class="nav-link" href="./admin">
                  Admin
                </a>
              </li>
              {% endif %}
              <li><a href="{{ url_for('logout') }}">Log Out</a></li>
            </ul>
          </div>
        </div>
      </nav>

        {% for match in matches %}     
            <div class = "Equipo1" style="color: rgb(255, 0, 234);">
                <div class="example-local">{{match.local}}</div>
                <form  id="{{match.local}}">
                    <input
                        type="number"
                        name="bet"
                        min="1"
                        max="5000"
                        id="bet-local-{{match.local}}"
                        placeholder="Place your bet"
                    >
                    <input type="submit"class="btn btn-success" value="Bet"></input>
                </form>   
            </div>

            <div class = "Rival" id="userr" data-user="{{id_}}" style="color: red;">
                <meta>Vs.</meta>
            </div>

            <div class = "Equipo2" style="color: rgb(255, 0, 234);">
              <div class="example-visit"> {{match.visit}}</div>
                <form id="{{match.visit}}">
                    <input
                        type="number"
                        name="bet"
                        id="bet-visit-{{match.visit}}"
                        placeholder="Place your bet"
                    >
                    <button type="submit" class="btn btn-success">Bet</button>
                </form>   
            </div>
            
    <script>
                document.getElementById('{{match.local}}').onsubmit = function(event) {
                event.preventDefault();
                var monto = document.getElementById('bet-local-{{match.local}}').value;
                var usuario = document.getElementById("userr").getAttribute("data-user");
                //const equipo = match.local;
                fetch('/update_user/{{id_}}',{
                    method: 'PATCH',
                    body: JSON.stringify({
                        'cash':monto
                    }),
                    headers: {
                        'Content-Type': 'application/json'
                    }});
                fetch('/create_bet', {
                    method: 'POST',
                    body: JSON.stringify({
                        'quota':1.5,
                        'bet_amount': monto,
                        'result':'{{match.local}}',
                        'id_user':usuario,
                        'match_code':'{{match.code}}'
                    }),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function(response){
                    return response.json()
                }).then(function(response_json){
                  document.getElementById('bet-local-{{match.local}}').value = null;
                });
              }
            document.getElementById("{{match.visit}}").onsubmit = function(event) {
                event.preventDefault();
                const monto = document.getElementById('bet-visit-{{match.visit}}').value;
                var usuario = document.getElementById("userr").getAttribute("data-user");
                fetch('/create_bet', {
                    method: 'POST',
                    body: JSON.stringify({
                        'quota':1.5,
                        'bet_amount': monto,
                        'result':'{{match.visit}}',
                        'id_user':usuario,
                        'match_code':'{{match.code}}'
                    }),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function(response){
                    return response.json()
                }).then(function(response_json){
                  document.getElementById('bet-visit-{{match.visit}}').value = null;
                });
            }
    </script>
    {% endfor %}
      {% endblock %}
</html>